{% extends 'base/admin.html' %}

{% block title %}Verify Users | RentEase Admin{% endblock %}

{% block content %}
<h2>Verify User Accounts</h2>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for user in pending_users %}
    <tr>
      <td>{{ user.name }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.role }}</td>
      <td>
        <!-- View Button triggers modal -->
        <button class="btn btn-info btn-sm mb-1" data-bs-toggle="modal" data-bs-target="#userModal{{ user.id }}">View</button>
        <form method="POST" style="display:inline;">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <button name="action" value="approve" class="btn btn-success btn-sm">Approve</button>
          <button name="action" value="reject" class="btn btn-danger btn-sm">Reject</button>
        </form>
      </td>
    </tr>

    <!-- User Detail Modal -->
    <div class="modal fade" id="userModal{{ user.id }}" tabindex="-1" aria-labelledby="userModalLabel{{ user.id }}" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="userModalLabel{{ user.id }}">User Details: {{ user.name }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Name:</strong> {{ user.name }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Role:</strong> {{ user.role }}</p>
            <p><strong>Contact:</strong> {{ user.contact }}</p>
            <p><strong>Profile Picture:</strong><br>
              {% if user.profile_pic %}
                <img src="{{ url_for('uploaded_file', filename=user.profile_pic) }}" alt="Profile Picture" style="max-width:120px; border-radius:8px;">
              {% else %}
                <span class="text-muted">No profile picture uploaded.</span>
              {% endif %}
            </p>
            <h6>Uploaded Documents:</h6>
            {% if user.user_docs %}
              <ul>
                {% for doc in user.user_docs %}
                  <li>
                    <a href="{{ url_for('uploaded_file', filename=doc.file_path) }}" target="_blank">{{ doc.doc_type|replace('_', ' ')|capitalize }}</a>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <span class="text-muted">No documents uploaded.</span>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form method="POST" style="display:inline;">
              <input type="hidden" name="user_id" value="{{ user.id }}">
              <button name="action" value="approve" class="btn btn-success btn-sm">Approve</button>
              <button name="action" value="reject" class="btn btn-danger btn-sm">Reject</button>
            </form>
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <tr><td colspan="4">No users pending verification.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}