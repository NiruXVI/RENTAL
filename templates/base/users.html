<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}RentEase{% endblock %}</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css">

<style>
body {
  background: linear-gradient(135deg, #BEE9E8, #CAE9FF);
  min-height: 100vh;
}
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(221, 221, 221, 0.3);
  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 1rem 2rem;
  z-index: 1000;
  height: 70px;
}
.nav-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 1400px;
  width: 100%;
}
.nav-brand {
  font-size: 1.8rem;
  font-weight: bold;
  color: #1B4965;
  letter-spacing: -0.5px;
}
.nav-links {
  display: flex;
  align-items: center;
  gap: 2rem;
  margin-left: auto;
}
.nav-links a {
  text-decoration: none;
  color: #1B4965;
  font-size: 1rem;
  font-weight: 500;
  padding: 0.6rem 1.2rem;
  border-radius: 6px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  border: 1px solid transparent;
}
.nav-links a:hover {
  color: #1B4965;
  background: rgba(27, 73, 101, 0.05);
  border-color: rgba(27, 73, 101, 0.1);
}
.nav-links a.active {
  color: #1B4965;
  background: rgba(27, 73, 101, 0.1);
  border-color: rgba(27, 73, 101, 0.2);
}
.nav-links a i {
  font-size: 1.1rem;
}
.logout-btn {
  background: rgba(220, 53, 69, 0.1) !important;
  color: #dc3545 !important;
}
.logout-btn:hover {
  background: #dc3545 !important;
  color: white !important;
}
body {
  padding-top: 70px; /* Reduced padding to match nav height exactly */
}

/* Mobile Responsive Navigation */
@media (max-width: 768px) {
  .top-nav {
    padding: 0.5rem 1rem;
    height: auto;
    min-height: 60px;
  }
  .nav-container {
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }
  .nav-brand {
    margin-right: 0;
    font-size: 1.3rem;
  }
  .nav-links {
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.8rem;
  }
  .nav-links a {
    font-size: 0.9rem;
    padding: 0.4rem 0.8rem;
  }
  body {
    padding-top: 80px;
  }
}
.property-card img {
  height: 150px;
  object-fit: cover;
}

/* Global color palette overrides */
.btn-primary {
  background-color: #5FA8D3 !important;
  border-color: #5FA8D3 !important;
}
.btn-primary:hover {
  background-color: #1B4965 !important;
  border-color: #1B4965 !important;
}
.btn-success {
  background-color: #62B6CB !important;
  border-color: #62B6CB !important;
}
.btn-success:hover {
  background-color: #1B4965 !important;
  border-color: #1B4965 !important;
}
.btn-info {
  background-color: #BEE9E8 !important;
  border-color: #BEE9E8 !important;
  color: #1B4965 !important;
}
.btn-info:hover {
  background-color: #62B6CB !important;
  border-color: #62B6CB !important;
  color: white !important;
}
.btn-warning {
  background-color: #CAE9FF !important;
  border-color: #CAE9FF !important;
  color: #1B4965 !important;
}
.btn-warning:hover {
  background-color: #5FA8D3 !important;
  border-color: #5FA8D3 !important;
  color: white !important;
}
.text-primary {
  color: #5FA8D3 !important;
}
.bg-primary {
  background-color: #5FA8D3 !important;
}
.border-primary {
  border-color: #5FA8D3 !important;
}
.badge.bg-success {
  background-color: #62B6CB !important;
}
.badge.bg-warning {
  background-color: #CAE9FF !important;
  color: #1B4965 !important;
}
.alert-success {
  background-color: #BEE9E8 !important;
  border-color: #62B6CB !important;
  color: #1B4965 !important;
}
.alert-info {
  background-color: #CAE9FF !important;
  border-color: #5FA8D3 !important;
  color: #1B4965 !important;
}
.card {
  background-color: rgba(255, 255, 255, 0.95) !important;
  backdrop-filter: blur(10px);
}
</style>

{% block extra_head %}{% endblock %}
</head>
<body>

<!-- Top Navigation Bar -->
<nav class="top-nav">
  <div class="nav-container">
    <div class="nav-brand">
      RentEase
    </div>
    <div class="nav-links">
      {% if session['role'] == 'tenant' %}
        <!-- Tenant Navigation: Find Properties, Messages, Profile, Logout -->
        <a href="{{ url_for('listings') }}" class="{% if 'listings' in request.path %}active{% endif %}">
          Find Properties
        </a>
        <a href="{{ url_for('messages') }}" class="{% if 'messages' in request.path %}active{% endif %}">
          Messages
        </a>
        <a href="{{ url_for('profile') }}" class="{% if 'profile' in request.path %}active{% endif %}">
          My Profile
        </a>
        <a href="{{ url_for('logout') }}" class="logout-btn">
          Logout
        </a>
      {% elif session['role'] == 'landlord' %}
        <!-- Landlord Navigation: Browse Properties, Add Property, Dashboard, Messages, Profile, Logout -->
        <a href="{{ url_for('listings') }}" class="{% if 'listings' in request.path %}active{% endif %}">
          Browse Properties
        </a>
        <a href="{{ url_for('add_listing') }}" class="{% if 'add' in request.path %}active{% endif %}">
          Add Property
        </a>
        <a href="{{ url_for('landlord_dashboard') }}" class="{% if 'landlord/dashboard' in request.path %}active{% endif %}">
          My Dashboard
        </a>
        <a href="{{ url_for('messages') }}" class="{% if 'messages' in request.path %}active{% endif %}">
          Messages
        </a>
        <a href="{{ url_for('profile') }}" class="{% if 'profile' in request.path %}active{% endif %}">
          My Profile
        </a>
        <a href="{{ url_for('logout') }}" class="logout-btn">
          Logout
        </a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="container" style="margin: 0; padding: 1rem 0 5rem 0;">
  {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ol@8.2.0/dist/ol.js"></script>

<script>
// Prevent back navigation for authenticated users
{% if session['user_id'] %}
// Replace current history entry
if (window.history.replaceState) {
    window.history.replaceState(null, null, window.location.href);
}

// Handle back button
window.addEventListener('popstate', function(event) {
    event.preventDefault();
    // Stay on current page or redirect to appropriate dashboard
    {% if session['role'] == 'tenant' %}
        window.location.href = "{{ url_for('listings') }}";
    {% else %}
        window.location.href = "{{ url_for('landlord_dashboard') if session['role'] == 'landlord' else url_for('listings') }}";
    {% endif %}
});

// Prevent caching for authenticated pages
window.addEventListener('beforeunload', function() {
    // Clear any cached data
    if (window.performance && window.performance.navigation.type === 2) {
        window.location.reload(true);
    }
});

// Check if page was loaded from cache (back button)
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        // Page was loaded from cache, reload it
        window.location.reload();
    }
});
{% endif %}
</script>

{% block extra_scripts %}{% endblock %}
</body>
</html>
